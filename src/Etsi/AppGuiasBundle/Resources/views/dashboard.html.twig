{% extends "EtsiAppGuiasBundle::baseLayout.html.twig" %}

{% block css %}
	{% stylesheets
		'@EtsiAppGuiasBundle/Resources/public/css/dataTables/dashboard_table.css' 
		'@EtsiAppGuiasBundle/Resources/public/css/chosen.css' %}
		<link rel="stylesheet" href="{{ asset_url }}" type="text/css" media="screen"/>
	{% endstylesheets %}
{% endblock %}


{% block js %}
	{% javascripts
		'@EtsiAppGuiasBundle/Resources/public/js/chosen.jquery.min.js' 
		'@EtsiAppGuiasBundle/Resources/public/js/jquery.dataTables.min.js'
		'@EtsiAppGuiasBundle/Resources/public/js/guia.dashboard.js' %}
		<script src="{{ asset_url }}" type="text/javascript"></script>
	{% endjavascripts %}
{% endblock %}

{% block titulo_cabecera %}
	AppDashboard
{% endblock %}

{% block wrapper %}
	<div id="steps">
		{% if is_granted('ROLE_REVISOR') %}
		<form action="{{ path('etsi_app_guia_guia_coordinador') }}" method="post">
			<fieldset class="step">
				<div class="contenedor" data-intro="Las guías docentes tienen que ser creadas en primera instancia por una persona en concreto. Esta persona es el coordinador de la asignatura, <b>al asignar coordinadores estás concediendo a dicho profesor el poder de crear guías de una determinada asignatura</b>." data-step="9">
					<div class="in-titulo">Gestión de coordinadores</div>

					<div class="clear"></div>
					<label for="asignatura" class="natural">Asignatura</label>
					<select name="asignatura" data-placeholder="Seleccionar..." class="long" >
						{% for a in asignaturas %}
						<option value="{{ a.id }}">
							{{- a.codigo }}: {{ a.nombre -}}
							{% if a.coordinador %} &lt;{{ a.coordinador.nombre }}&gt;{% endif -%}
						</option>
						{% endfor %}
					</select>

					<div class="clear"></div>
					<label for="profesor" class="natural">Profesor</label>
					<select name="profesor" data-placeholder="Seleccionar..." class="long" >
						{% for p in profesores %}
						<option value="{{ p.id }}">{{ p.nombre }} &lt;{{ p.email }}&gt;</option>
						{% endfor %}
					</select>

					<div class="contenedor submit">
						<button id="registerButton" type="submit">ASIGNAR COORDINADOR</button>
					</div>
				</div>
			</fieldset>
		</form>

		<form>
			<fieldset class="step" style="margin-bottom: 50px;">
				<div class="contenedor" data-intro="Parece ser que eres una persona con criterio, por ello se te ha concedido acceso a todas las guías y poder para modificar su estádo actual. Aquí tienes un resumen de todas las guías, por defecto <b>se encuentran filtradas y solo ves las guías pendientes de aprobación</b>." data-step="7">
					<div class="in-titulo">Guias</div>

					<div class="clear"></div>
					<table id="tabla-todo"> 
						<thead> 
							<tr> 
								<th>Asignatura</th> 
								<th>Estado</th>
								<th>Fecha de modificación</th> 
								<th>Curso</th>
							</tr> 
						</thead> 
						<tbody>
							{% for e in guias %}
							<tr>
								<td>
									<a href="{{ path('etsi_app_guia_guia_pasos', {'id': e.id}) }}">
										{{ e.asignatura.nombre }} &lt;{{ e.asignatura.codigo }}&gt;
									</a>
								</td>
								<td>{{ estados[e.estado] }} </td>
								<td>{{ e.fechaDeModificacion|date("d/m/Y H:i") }}</td>
								<td>{{ e.curso }} - {{ e.curso+1 }}</td>
							</tr>
							{% endfor %}
						</tbody> 
					</table>

					<div style="margin-top: 50px; width: 100%"></div>
					<label>Filtros según estado</label>
					<button class="boton-chico" id="filtro-enviar" data-intro="Con ese filtro puedes visualizar las guías que están siendo creadas." data-step="8">Pendientes de envío</button>
					<button class="boton-chico" id="filtro-aprobar" data-intro="Con ese filtro puedes visualizar las guías que <b>esperan tu aprobación para ser publicadas</b>." data-step="8">Pendientes de aprobación</button>
					<button class="boton-chico" id="filtro-publicada" data-intro="Con ese filtro puedes visualizar las guías publicadas." data-step="8">Publicadas</button>
					<button class="boton-chico" id="filtro-fallos" data-intro="Con ese filtro puedes visualizar las guías publicadas pero que, según se ha notificado, poseen algún tipo de error." data-step="8">Publicadas con fallos</button>
					<button class="boton-chico" id="filtro-todo" data-intro="Con ese filtro puedes verás todas las guías juntas..." data-step="8">Todas las guías</button>
					<div class="clear"></div>
				</div>
			</fieldset>
		</form>
		{% endif %}

		{% if entity.asignaturasCoordinadas|length > 0 %}
		<form action="{{ path('etsi_app_guia_guia_new') }}" method="post">
			<fieldset class="step" style="margin-bottom: 50px;">
				<div class="contenedor" data-intro="Al parecer tienes asignada la coordinación de algunas asignaturas. Esto te permite crear guías de dichas asignaturas. Cuando crees una guía, <b>no olvides agregar en la misma los profesores con docencia</b>, de otro modo no podrán acceder a la guía para colaborar en al edición." data-step="6">
					<div class="in-titulo">Asignaturas coordinadas</div>

					<div class="clear"></div>
					<label for="asignatura" class="natural">Asignatura</label>
					<select name="asignatura" data-placeholder="Seleccionar..." class="long" >
						{% for a in entity.asignaturasCoordinadas %}
						<option value="{{ a.id }}">{{ a.codigo }}: {{ a.nombre }}</option>
						{% endfor %}
					</select>

					<div class="clear"></div>
					<label for="curso" class="natural">Curso</label>
					<select name="curso" data-placeholder="Seleccionar..." class="peque" >
						{% for curso in range(("now"|date("Y"))-1,("now"|date("Y"))+1) %}
						<option value="{{ curso }}">{{ curso }} - {{ curso+1 }}</option>
						{% endfor %}
					</select>

					<div class="contenedor submit">
						<button id="registerButton" type="submit">CREAR NUEVA GUÍA</button>
					</div>
				</div>
			</fieldset>
		</form>
		{% endif %}

		<form>
			<fieldset class="step">
				<div class="contenedor" data-intro="Estas son las guías en las que tienes participación y que han sido marcadas como erroneas. Estas guías también aparecen en la tabla anterior, pero se ponen aquí arriba solas para que se vean bien, pues <b>si una guía publicada contiene errores es importante que la corrijas lo antes posible</b>." data-step="5">
					<div class="in-titulo">Guias con errores</div>

					<div class="clear"></div>
					{% if entity %}
					<table id="errores"> 
						<thead> 
							<tr> 
								<th>Código de la asignatura</th>
								<th>Nombre de la asignatura</th>
								<th>Última modificación</th>
								<th>Curso</th> 
							</tr> 
						</thead> 
						<tbody>
							{% for e in entity.guias %}
							{% if e.estado==3 %}
							<tr>
								<td>
									<a href="{{ path('etsi_app_guia_guia_pasos', {'id': e.id}) }}">
										{{ e.asignatura.codigo }}
									</a>
								</td>
								<td>
									<a href="{{ path('etsi_app_guia_guia_pasos', {'id': e.id}) }}">
										{{ e.asignatura.nombre }}
									</a>
								</td>
								<td>{{ e.fechaDeModificacion|date("d/m/Y H:i") }} </td>
								<td>{{ e.curso }} - {{ e.curso+1 }}</td>
							</tr>
							{% endif %}
							{% endfor %}
						</tbody> 
					</table>
					{% endif %}
				</div>
				<div class="contenedor" data-intro="Aquí tienes un resumen de todas las guías en las que tienes participación. <b>Para editar una guía simplemente pincha en su código o nombre</b>. Pudes ordenar y filtrar esta tabla (y prácticamente cualquier tabla dentro de la app)." data-step="4" data-position="top">
					<div class="in-titulo">Todas tus guías</div>

					<div class="clear"></div>
					{% if entity %}
					<table id="guias"> 
						<thead> 
							<tr> 
								<th>Código de la asignatura</th>
								<th>Nombre de la asignatura</th>
								<th>Estado</th>
								<th>Curso</th> 
							</tr> 
						</thead> 
						<tbody>
							{% for e in entity.guias %}
							<tr>
								<td>
									<a href="{{ path('etsi_app_guia_guia_pasos', {'id': e.id}) }}">
										{{ e.asignatura.codigo }}
									</a>
								</td>
								<td>
									<a href="{{ path('etsi_app_guia_guia_pasos', {'id': e.id}) }}">
										{{ e.asignatura.nombre }}
									</a>
								</td>
								<td>{{ estados[e.estado] }} </td>
								<td>{{ e.curso }} - {{ e.curso+1 }}</td>
							</tr>
							{% endfor %}
						</tbody> 
					</table>
					{% endif %}
				</div>
			</fieldset>
		</form>
	</div>
{% endblock %}